<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Deal Submission Form</title>
    <style>
        :root {
            --primary-blue: #5d78d6;
            --primary-purple: #6e50c4;
            --light-blue: #eef1fa;
            --light-purple: #f0ecf9;
            --dark-text: #333;
            --light-text: #666;
            --border-color: #e0e0e0;
            --section-bg: #ffffff;
            --hover-color: #f5f7ff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-text);
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-purple);
            font-weight: 600;
            font-size: 32px;
        }

        h3 {
            color: var(--primary-blue);
            border-bottom: 2px solid var(--primary-blue);
            padding-bottom: 8px;
            margin-top: 25px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .form-container {
            background-color: var(--section-bg);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
        }

        .form-section {
            background-color: var(--section-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary-blue);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }

        .form-section-alt {
            border-left: 4px solid var(--primary-purple);
        }

        .form-header {
            background: linear-gradient(to right, var(--light-blue), var(--light-purple));
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 8px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            width: 100%;
            gap: 15px;
        }

        .form-col {
            flex: 1;
            min-width: 200px;
        }

        .form-field {
            margin-bottom: 15px;
        }

        .form-field label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--dark-text);
            font-size: 14px;
        }

        .form-field input, .form-field select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #6e50c4; /* Changed from var(--border-color) to the purple color */
            border-radius: 6px;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-field input:focus, .form-field select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(14, 139, 248, 0.15);
        }

        .invalid-input {
            border-color: #dc3545 !important;
            background-color: rgba(220, 53, 69, 0.05);
        }

        .invalid-input:focus {
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.15) !important;
        }

        .radio-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 5px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
            font-size: 14px;
        }

        .radio-group input {
            margin-right: 6px;
            width: auto;
            cursor: pointer;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
        }

        .checkbox-group input {
            margin-right: 6px;
            width: auto;
            cursor: pointer;
        }

        .field-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .field-group .form-field {
            flex: 1;
            min-width: 150px;
        }

        .notice {
            background-color: var(--light-blue);
            padding: 15px;
            border-left: 4px solid var(--primary-blue);
            margin-bottom: 25px;
            border-radius: 6px;
            font-size: 14px;
        }

        .attestation-area {
            margin-top: 30px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--light-purple);
            border-radius: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: flex-start;
            font-size: 14px;
            margin-top: 10px;
        }

        .checkbox-label input {
            margin-right: 10px;
            margin-top: 4px;
        }

        /* Vehicle Information Section - Responsive Grid */
        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Terms Section - Responsive Design */
        .terms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .terms-full-row {
            grid-column: 1 / -1;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .terms-item {
            margin-bottom: 15px;
        }

        .terms-item label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .terms-label {
            font-weight: 500;
            background-color: var(--light-purple);
            color: var(--primary-purple);
            padding: 6px 10px;
            border-radius: 4px;
        }

        .terms-total {
            font-weight: 600;
            background-color: var(--light-blue);
            padding: 6px 10px;
            border-radius: 4px;
        }

        .terms-amount-financed {
            font-weight: 600;
            background-color: var(--light-purple);
            color: var(--primary-purple);
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .currency-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #6e50c4; /* Changed from var(--border-color) to the purple color */
            border-radius: 6px;
            box-sizing: border-box;
            text-align: right;
            font-family: inherit;
            font-size: 14px;
        }

        .tax-rate-input {
            display: flex;
            gap: 5px;
        }

        .tax-rate-input input:first-child {
            width: 80px;
            text-align: right;
        }

        .submit-btn, .add-borrower-btn {
            background: linear-gradient(to right, var(--primary-blue), var(--primary-purple));
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .submit-btn:hover, .add-borrower-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
         /* Style for the remove button */
        .remove-borrower-btn {
            background: linear-gradient(to right, #d65d5d, #c4506e); /* Reddish gradient */
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .remove-borrower-btn:hover {
             transform: translateY(-2px);
             box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }


        .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 12px;
            color: var(--light-text);
            padding: 15px;
            border-top: 1px solid var(--border-color);
        }

        /* Borrower Sections Styles */
        .borrower-container {
            position: relative;
            margin-bottom: 30px;
        }

        .borrower-header {
            background: linear-gradient(to right, var(--primary-blue), var(--primary-purple));
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .add-borrower-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        /* Initially hide previous address/employment sections */
        .hidden-section {
            display: none;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 10px;
            }

            .form-col {
                width: 100%;
            }

            .radio-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .vehicle-grid {
                grid-template-columns: 1fr;
            }

            .terms-grid {
                grid-template-columns: 1fr;
            }

            .tax-rate-input {
                flex-direction: column;
            }

            .tax-rate-input input:first-child {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Credit Application</h1>

        <form id="creditApplication">
            <div class="form-section">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-field">
                            <label for="dealerName">Dealer Name:</label>
                            <input type="text" id="dealerName" name="dealerName">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-field">
                            <label for="telephone">Tel:</label>
                            <input type="tel" id="telephone" name="telephone">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-field">
                            <label for="contact">Contact:</label>
                            <input type="text" id="contact" name="contact">
                        </div>
                    </div>
                </div>
            </div>

            <div class="notice">
                <strong>IMPORTANT APPLICANT INFORMATION:</strong> Federal Law requires financial institutions to obtain sufficient information to verify your identity. You may be asked several questions and to provide one or more forms of identification to fulfill this requirement. In some instances we may use outside sources to confirm the information. The information you provide is protected by our privacy policy and federal law.
            </div>

            <!-- Borrower 1 Container - Start -->
            <div class="borrower-container" id="borrower1Container">
                <div class="borrower-header">Primary Borrower</div>

                <!-- Personal Information Section -->
                <div class="form-section form-section-alt borrower-personal-section">
                    <h3>Personal Information</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-field">
                                <label for="applicant">Applicant:</label>
                                <input type="text" id="applicant" name="borrower1_applicant">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="dob">Date of birth:</label>
                                <input type="date" id="dob" name="borrower1_dob">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="ssn">SSN:</label>
                                <input type="text" id="ssn" name="borrower1_ssn">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="driversLicense">Driver's License:</label>
                                <input type="text" id="driversLicense" name="borrower1_driversLicense">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-field">
                                <label for="homePhone">Home:</label>
                                <input type="tel" id="homePhone" name="borrower1_homePhone">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="workPhone">Work:</label>
                                <input type="tel" id="workPhone" name="borrower1_workPhone">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="cellPhone">Cell:</label>
                                <input type="tel" id="cellPhone" name="borrower1_cellPhone">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="email">E-Mail:</label>
                                <input type="email" id="email" name="borrower1_email">
                            </div>
                        </div>
                    </div>
                </div> <!-- End of Personal Information Section -->

                <!-- Address Information Section -->
                <div class="form-section borrower-address-section">
                    <h3>Address Information</h3>
                    <div class="form-row">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label>Current address & Type:</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="borrower1_addressType" value="own"> Own</label>
                                    <label><input type="radio" name="borrower1_addressType" value="rent"> Rent</label>
                                    <label><input type="radio" name="borrower1_addressType" value="other"> Other</label>
                                </div>
                                <input type="text" id="currentAddress" name="borrower1_currentAddress" placeholder="Address" style="margin-top: 10px;">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 1;">
                            <div class="form-field">
                                <label for="landlordInfo">Landlord/Mortgage Co. & Phone:</label>
                                <input type="text" id="landlordInfo" name="borrower1_landlordInfo">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 0.5;">
                            <div class="form-field">
                                <label for="currentAddressYears">Years:</label>
                                <input type="number" id="currentAddressYears" name="borrower1_currentAddressYears" min="0">
                            </div>
                            <div class="form-field">
                                <label for="currentAddressMonths">Months:</label>
                                <input type="number" id="currentAddressMonths" name="borrower1_currentAddressMonths" min="0" max="11">
                            </div>
                        </div>
                    </div>

                    <!-- Previous address 1 -->
                    <div class="form-row hidden-section" data-address-level="1">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="previousAddress1">Previous address 1:</label>
                                <input type="text" id="previousAddress1" name="borrower1_previousAddress1">
                            </div>
                        </div>
                        <!-- Added Landlord/Mortgage field for Previous Address 1 -->
                        <div class="form-col" style="flex: 1;">
                            <div class="form-field">
                                <label for="prevAddress1LandlordInfo">Landlord/Mortgage Co. & Phone:</label>
                                <input type="text" id="prevAddress1LandlordInfo" name="borrower1_prevAddress1LandlordInfo">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 0.5;">
                            <div class="form-field">
                                <label for="prevAddress1Years">Years:</label>
                                <input type="number" id="prevAddress1Years" name="borrower1_prevAddress1Years" min="0">
                            </div>
                            <div class="form-field">
                                <label for="prevAddress1Months">Months:</label>
                                <input type="number" id="prevAddress1Months" name="borrower1_prevAddress1Months" min="0" max="11">
                            </div>
                        </div>
                    </div>

                    <!-- Previous address 2 -->
                    <div class="form-row hidden-section" data-address-level="2">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="previousAddress2">Previous address 2:</label>
                                <input type="text" id="previousAddress2" name="borrower1_previousAddress2">
                            </div>
                        </div>
                         <!-- Added Landlord/Mortgage field for Previous Address 2 -->
                        <div class="form-col" style="flex: 1;">
                            <div class="form-field">
                                <label for="prevAddress2LandlordInfo">Landlord/Mortgage Co. & Phone:</label>
                                <input type="text" id="prevAddress2LandlordInfo" name="borrower1_prevAddress2LandlordInfo">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 0.5;">
                            <div class="form-field">
                                <label for="prevAddress2Years">Years:</label>
                                <input type="number" id="prevAddress2Years" name="borrower1_prevAddress2Years" min="0">
                            </div>
                            <div class="form-field">
                                <label for="prevAddress2Months">Months:</label>
                                <input type="number" id="prevAddress2Months" name="borrower1_prevAddress2Months" min="0" max="11">
                            </div>
                        </div>
                    </div>
                </div> <!-- End of Address Information Section -->

                <!-- Employment Information Section -->
                <div class="form-section form-section-alt borrower-employment-section">
                    <h3>Employment Information</h3>
                    <div class="form-row">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="currentEmployer">Current Employer:</label>
                                <input type="text" id="currentEmployer" name="borrower1_currentEmployer">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="employerPhone">Phone:</label>
                                <input type="tel" id="employerPhone" name="borrower1_employerPhone">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="title">Title:</label>
                                <input type="text" id="title" name="borrower1_title">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="employerAddress">Employer Address:</label>
                                <input type="text" id="employerAddress" name="borrower1_employerAddress">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="income">Income:</label>
                                <input type="text" id="income" name="borrower1_income" class="currency-input">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 0.5;">
                            <div class="form-field">
                                <label for="employmentYears">Years:</label>
                                <input type="number" id="employmentYears" name="borrower1_employmentYears" min="0">
                            </div>
                            <div class="form-field">
                                <label for="employmentMonths">Months:</label>
                                <input type="number" id="employmentMonths" name="borrower1_employmentMonths" min="0" max="11">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-field">
                                <label for="otherIncome">Other Income:</label>
                                <input type="text" id="otherIncome" name="borrower1_otherIncome" class="currency-input">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="incomeSource">Source (Alimony, child support or separate maintenance income need not be revealed if you do not wish):</label>
                                <input type="text" id="incomeSource" name="borrower1_incomeSource">
                            </div>
                        </div>
                    </div>

                    <!-- Previous Employer 1 -->
                    <div class="form-row hidden-section" data-employment-level="1">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="previousEmployer1">Previous Employer 1:</label>
                                <input type="text" id="previousEmployer1" name="borrower1_previousEmployer1">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="prevEmployer1Phone">Phone:</label>
                                <input type="tel" id="prevEmployer1Phone" name="borrower1_prevEmployer1Phone">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="prevEmployer1Title">Title:</label>
                                <input type="text" id="prevEmployer1Title" name="borrower1_prevEmployer1Title">
                            </div>
                        </div>
                    </div>

                    <div class="form-row hidden-section" data-employment-level="1">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="prevEmployer1Address">Employer Address:</label>
                                <input type="text" id="prevEmployer1Address" name="borrower1_prevEmployer1Address">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="prevEmployer1Income">Income:</label>
                                <input type="text" id="prevEmployer1Income" name="borrower1_prevEmployer1Income" class="currency-input">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 0.5;">
                            <div class="form-field">
                                <label for="prevEmployment1Years">Years:</label>
                                <input type="number" id="prevEmployment1Years" name="borrower1_prevEmployment1Years" min="0">
                            </div>
                            <div class="form-field">
                                <label for="prevEmployment1Months">Months:</label>
                                <input type="number" id="prevEmployment1Months" name="borrower1_prevEmployment1Months" min="0" max="11">
                            </div>
                        </div>
                    </div>

                    <!-- Previous Employer 2 -->
                    <div class="form-row hidden-section" data-employment-level="2">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="previousEmployer2">Previous Employer 2:</label>
                                <input type="text" id="previousEmployer2" name="borrower1_previousEmployer2">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="prevEmployer2Phone">Phone:</label>
                                <input type="tel" id="prevEmployer2Phone" name="borrower1_prevEmployer2Phone">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="prevEmployer2Title">Title:</label>
                                <input type="text" id="prevEmployer2Title" name="borrower1_prevEmployer2Title">
                            </div>
                        </div>
                    </div>

                    <div class="form-row hidden-section" data-employment-level="2">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="prevEmployer2Address">Employer Address:</label>
                                <input type="text" id="prevEmployer2Address" name="borrower1_prevEmployer2Address">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="prevEmployer2Income">Income:</label>
                                <input type="text" id="prevEmployer2Income" name="borrower1_prevEmployer2Income" class="currency-input">
                            </div>
                        </div>
                        <div class="form-col" style="flex: 0.5;">
                            <div class="form-field">
                                <label for="prevEmployment2Years">Years:</label>
                                <input type="number" id="prevEmployment2Years" name="borrower1_prevEmployment2Years" min="0">
                            </div>
                            <div class="form-field">
                                <label for="prevEmployment2Months">Months:</label>
                                <input type="number" id="prevEmployment2Months" name="borrower1_prevEmployment2Months" min="0" max="11">
                            </div>
                        </div>
                    </div>
                </div> <!-- End of Employment Information Section -->

                <!-- Financial Information Section -->
                <div class="form-section borrower-financial-section">
                    <h3>Financial Information</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-field">
                                <label>Are you obliged to make Alimony, Support or Maintenance payments?</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="borrower1_alimonyPayments" value="no"> No</label>
                                    <label><input type="radio" name="borrower1_alimonyPayments" value="yes"> Yes</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label for="alimonyRecipient">If yes, to (Name & Address):</label>
                                <input type="text" id="alimonyRecipient" name="borrower1_alimonyRecipient">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="alimonyAmount">Amt. per month $:</label>
                                <input type="text" id="alimonyAmount" name="borrower1_alimonyAmount" class="currency-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label>Are you a co-maker, endorser, or guarantor on any loan or contract?</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="borrower1_coMaker" value="no"> No</label>
                                    <label><input type="radio" name="borrower1_coMaker" value="yes"> Yes</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="coMakerFor">If yes, for whom?</label>
                                <input type="text" id="coMakerFor" name="borrower1_coMakerFor">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="coMakerToWhom">To whom?</label>
                                <input type="text" id="coMakerToWhom" name="borrower1_coMakerToWhom">

                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label>Are there any unsatisfied judgments against you?</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="borrower1_judgments" value="no"> No</label>
                                    <label><input type="radio" name="borrower1_judgments" value="yes"> Yes</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="judgmentToWhom">If yes, to whom owed?</label>
                                <input type="text" id="judgmentToWhom" name="borrower1_judgmentToWhom">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="judgmentAmount">Amount $:</label>
                                <input type="text" id="judgmentAmount" name="borrower1_judgmentAmount" class="currency-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col" style="flex: 2;">
                            <div class="form-field">
                                <label>Have you been declared bankrupt in the last 10 years?</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="borrower1_bankruptcy" value="no"> No</label>
                                    <label><input type="radio" name="borrower1_bankruptcy" value="yes"> Yes</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="bankruptcyWhere">If yes, where?</label>
                                <input type="text" id="bankruptcyWhere" name="borrower1_bankruptcyWhere">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-field">
                                <label for="bankruptcyYear">Year?</label>
                                <input type="text" id="bankruptcyYear" name="borrower1_bankruptcyYear">
                            </div>
                        </div>
                    </div>
                </div> <!-- End of Financial Information Section -->
            </div>
            <!-- Borrower 1 Container - End -->

            <!-- Add/Remove Borrower Button -->
            <div class="add-borrower-container" id="toggleBorrowerButtonContainer">
                <button type="button" id="toggleBorrowerBtn" class="add-borrower-btn">Add Co-Borrower</button>
            </div>

            <!-- Borrower 2 Container - Will be initially hidden and added dynamically -->
            <div class="borrower-container" id="borrower2Container" style="display: none;">
                 <!-- Content will be added by JS -->
            </div>

            <!-- Dealer Attestation Section -->
            <div class="form-section form-section-alt">
                <div class="attestation-area">
                    <p style="font-weight: 500; color: var(--primary-purple);">DEALER ATTESTATION</p>
                    <p>I, as an authorized representative of the dealership, certify that everything stated in this application is correct. I confirm that I have received authorization from the applicant to submit this application. The applicant understands that the Lender may check their credit and employment history and answer questions others may ask the Lender about the applicant's credit record with the Lender. The applicant also understands that they must update credit information at Lender's request if their financial condition changes.</p>

                    <label class="checkbox-label">
                        <input type="checkbox" id="dealerAttestation" name="dealerAttestation" required>
                        I agree to the above statements and confirm that I am authorized to submit this application on behalf of the applicant.
                    </label>

                    <div class="form-field" style="margin-top: 15px;">
                        <label for="signatureDate">Date:</label>
                        <input type="date" id="signatureDate" name="signatureDate" required>
                    </div>
                </div>
            </div>

            <!-- Vehicle Information Section -->
            <div class="form-section">
                <h3>Vehicle Information</h3>
                <div class="vehicle-grid">
                    <div class="form-field">
                        <label for="vehicleYear">Year:</label>
                        <input type="text" id="vehicleYear" name="vehicleYear">
                    </div>
                    <div class="form-field">
                        <label for="vehicleMakeModel">Make & Model:</label>
                        <input type="text" id="vehicleMakeModel" name="vehicleMakeModel">
                    </div>
                    <div class="form-field">
                        <label for="vehicleTrim">Trim:</label>
                        <input type="text" id="vehicleTrim" name="vehicleTrim">
                    </div>
                    <div class="form-field">
                        <label for="vehicleMileage">Mileage:</label>
                        <input type="text" id="vehicleMileage" name="vehicleMileage">
                    </div>
                    <div class="form-field">
                        <label for="vehicleVIN">VIN:</label>
                        <input type="text" id="vehicleVIN" name="vehicleVIN">
                    </div>
                </div>
            </div>

            <!-- Terms Section -->
            <div class="form-section form-section-alt">
                <h3>Terms</h3>
                <div class="terms-grid">
                    <div class="terms-item">
                        <label class="terms-label">a. Selling Price:</label>
                        <input type="text" id="sellingPrice" name="sellingPrice" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">b. Warranty:</label>
                        <input type="text" id="warranty" name="warranty" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">c. GAP:</label>
                        <input type="text" id="gap" name="gap" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">d. Other:</label>
                        <input type="text" id="other" name="other" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">e. Taxes:</label>
                        <div class="tax-rate-input">
                            <input type="text" id="taxRate" name="taxRate" placeholder="0.0%">
                            <input type="text" id="taxes" name="taxes" class="currency-input" placeholder="$0.00" readonly>
                        </div>
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">f. Doc Fees:</label>
                        <input type="text" id="docFees" name="docFees" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">g. Title/Lien/Reg Fees:</label>
                        <input type="text" id="titleFees" name="titleFees" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-total">l. Total Price: (Sum a:g)</label>
                        <input type="text" id="totalPrice" name="totalPrice" class="currency-input" readonly>
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">h. Total Cash Down:</label>
                        <input type="text" id="cashDown" name="cashDown" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">i. Trade Value:</label>
                        <input type="text" id="tradeValue" name="tradeValue" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">j. Trade Payoff:</label>
                        <input type="text" id="tradePayoff" name="tradePayoff" class="currency-input" placeholder="$0.00">
                    </div>

                    <div class="terms-item">
                        <label class="terms-label">k. Net Trade Value:</label>
                        <input type="text" id="netTradeValue" name="netTradeValue" class="currency-input" readonly>
                    </div>

                    <div class="terms-full-row">
                        <div class="terms-item" style="flex: 1;">
                            <label class="terms-total">m. Total Down: (Sum h:k)</label>
                            <input type="text" id="totalDown" name="totalDown" class="currency-input" readonly>
                        </div>

                        <div class="terms-item" style="flex: 1;">
                            <div class="terms-amount-financed">
                                <span>Amount Financed (l-m):</span>
                                <input type="text" id="amountFinanced" name="amountFinanced" class="currency-input" style="width: 150px;" readonly>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-row" style="justify-content: center; margin-top: 30px;">
                <button type="submit" class="submit-btn">Submit Application</button>
            </div>
        </form>


        <div class="footer">
            Form provided by pinnacleautofinance.com â€” brokered financing solutions portal.  | Visit www.pinnacleautofinance.com or call 786.731.8493 to learn more
        </div>
    </div>

    <script>
        // Document ready function
        document.addEventListener('DOMContentLoaded', function() {

            // --- Currency Formatting and Calculations (Keep these) ---

            const formatCurrency = (input) => {
                let value = input.value.replace(/[^\d.]/g, '');
                const parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }
                if (parts.length > 1) {
                    value = parts[0] + '.' + parts[1].slice(0, 2);
                }
                if (value) {
                    const num = parseFloat(value);
                    if (!isNaN(num)) {
                        value = num.toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                    }
                }
                input.value = value ? '$' + value : '';
            };

            const parseCurrency = (value) => {
                return parseFloat(value.replace(/[$,]/g, '')) || 0;
            };

            const parsePercentage = (value) => {
                return parseFloat(value.replace(/[%]/g, '')) / 100 || 0;
            };

            const calculateTotals = () => {
                const sellingPrice = parseCurrency(document.getElementById('sellingPrice').value);
                const warranty = parseCurrency(document.getElementById('warranty').value);
                const gap = parseCurrency(document.getElementById('gap').value);
                const other = parseCurrency(document.getElementById('other').value);
                const docFees = parseCurrency(document.getElementById('docFees').value);
                const titleFees = parseCurrency(document.getElementById('titleFees').value);

                const tradeValue = parseCurrency(document.getElementById('tradeValue').value);
                const tradePayoff = parseCurrency(document.getElementById('tradePayoff').value);
                const netTradeValue = tradeValue - tradePayoff;
                const netTradeValueInput = document.getElementById('netTradeValue');
                 if (netTradeValueInput) {
                     netTradeValueInput.value = '$' + netTradeValue.toLocaleString('en-US', {
                         minimumFractionDigits: 2,
                         maximumFractionDigits: 2
                     });
                 }


                const taxRate = parsePercentage(document.getElementById('taxRate').value);
                const taxableAmount = sellingPrice + warranty + gap + other;
                const taxes = taxableAmount * taxRate;

                const taxesInput = document.getElementById('taxes');
                 if (taxesInput) {
                     taxesInput.value = '$' + taxes.toLocaleString('en-US', {
                         minimumFractionDigits: 2,
                         maximumFractionDigits: 2
                     });
                 }


                const totalPrice = sellingPrice + warranty + gap + other + taxes + docFees + titleFees;
                const totalPriceInput = document.getElementById('totalPrice');
                 if (totalPriceInput) {
                     totalPriceInput.value = '$' + totalPrice.toLocaleString('en-US', {
                         minimumFractionDigits: 2,
                         maximumFractionDigits: 2
                     });
                 }


                const cashDown = parseCurrency(document.getElementById('cashDown').value);
                const totalDown = cashDown + netTradeValue;
                const totalDownInput = document.getElementById('totalDown');
                 if (totalDownInput) {
                     totalDownInput.value = '$' + totalDown.toLocaleString('en-US', {
                         minimumFractionDigits: 2,
                         maximumFractionDigits: 2
                     });
                 }


                const amountFinanced = totalPrice - totalDown;
                const amountFinancedInput = document.getElementById('amountFinanced');
                 if (amountFinancedInput) {
                     amountFinancedInput.value = '$' + amountFinanced.toLocaleString('en-US', {
                         minimumFractionDigits: 2,
                         maximumFractionDigits: 2
                     });
                 }

            };

             const formatTaxRate = (input) => {
                let value = input.value.replace(/[^\d.]/g, '');
                const parts = value.split('.');
                if (parts.length > 2) {
                    value = parts[0] + '.' + parts.slice(1).join('');
                }
                input.value = value ? value + '%' : '';
                calculateTotals();
            };

            document.querySelectorAll('.currency-input').forEach(input => {
                input.addEventListener('blur', function() { formatCurrency(this); });
                input.addEventListener('focus', function() { this.value = this.value.replace(/[$,]/g, ''); });
            });

            const taxRateInput = document.getElementById('taxRate');
            if (taxRateInput) {
                taxRateInput.addEventListener('blur', function() { formatTaxRate(this); });
                taxRateInput.addEventListener('focus', function() { this.value = this.value.replace(/%/g, ''); });
            }

            const calculationInputs = document.querySelectorAll('.terms-grid input:not([readonly])');
            calculationInputs.forEach(input => {
                input.addEventListener('input', calculateTotals);
                input.addEventListener('blur', calculateTotals);
            });

            calculateTotals();


            // --- Conditional Display Logic for Address and Employment (Keep these) ---

            const updateAddressVisibility = (borrowerContainerId) => {
                const container = document.getElementById(borrowerContainerId);
                if (!container) return;

                const currentYearsInput = container.querySelector('[id$="currentAddressYears"]');
                const currentMonthsInput = container.querySelector('[id$="currentAddressMonths"]');
                const prevAddress1Row = container.querySelector('[data-address-level="1"]');
                const prevAddress2Row = container.querySelector('[data-address-level="2"]');
                const prev1YearsInput = container.querySelector('[id$="prevAddress1Years"]');
                const prev1MonthsInput = container.querySelector('[id$="prevAddress1Months"]');

                if (!currentYearsInput || !currentMonthsInput || !prevAddress1Row || !prevAddress2Row || !prev1YearsInput || !prev1MonthsInput) {
                     // console.error("Missing required elements for address visibility update in container:", borrowerContainerId);
                     return;
                }

                const currentYears = parseInt(currentYearsInput.value) || 0;
                const currentMonths = parseInt(currentMonthsInput.value) || 0;
                const totalCurrentMonths = (currentYears * 12) + currentMonths;

                const prev1Years = parseInt(prev1YearsInput.value) || 0;
                const prev1Months = parseInt(prev1MonthsInput.value) || 0;
                const totalPrev1Months = (prev1Years * 12) + prev1Months;

                if (totalCurrentMonths >= 12) {
                    prevAddress1Row.style.display = 'flex';
                    const totalCombinedMonths = totalCurrentMonths + totalPrev1Months;
                    if (totalCombinedMonths < 24) {
                        prevAddress2Row.style.display = 'flex';
                    } else {
                        prevAddress2Row.style.display = 'none';
                        prevAddress2Row.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => input.value = '');
                    }
                } else {
                    prevAddress1Row.style.display = 'none';
                    prevAddress2Row.style.display = 'none';
                    prevAddress1Row.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => input.value = '');
                    prevAddress2Row.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => input.value = '');
                }
            };

             const updateEmploymentVisibility = (borrowerContainerId) => {
                const container = document.getElementById(borrowerContainerId);
                 if (!container) return;

                const currentYearsInput = container.querySelector('[id$="employmentYears"]');
                const currentMonthsInput = container.querySelector('[id$="employmentMonths"]');
                const prevEmployer1Rows = container.querySelectorAll('[data-employment-level="1"]');
                const prevEmployer2Rows = container.querySelectorAll('[data-employment-level="2"]');
                const prev1YearsInput = container.querySelector('[id$="prevEmployment1Years"]');
                const prev1MonthsInput = container.querySelector('[id$="prevEmployment1Months"]');


                 if (!currentYearsInput || !currentMonthsInput || prevEmployer1Rows.length === 0 || prevEmployer2Rows.length === 0 || !prev1YearsInput || !prev1MonthsInput) {
                     // console.error("Missing required elements for employment visibility update in container:", borrowerContainerId);
                     return;
                 }


                const currentYears = parseInt(currentYearsInput.value) || 0;
                const currentMonths = parseInt(currentMonthsInput.value) || 0;
                const totalCurrentMonths = (currentYears * 12) + currentMonths;

                 const prev1Years = parseInt(prev1YearsInput.value) || 0;
                 const prev1Months = parseInt(prev1MonthsInput.value) || 0;
                 const totalPrev1Months = (prev1Years * 12) + prev1Months;

                if (totalCurrentMonths >= 12) {
                    prevEmployer1Rows.forEach(row => row.style.display = 'flex');
                    const totalCombinedMonths = totalCurrentMonths + totalPrev1Months;
                    if (totalCombinedMonths < 24) {
                        prevEmployer2Rows.forEach(row => row.style.display = 'flex');
                    } else {
                        prevEmployer2Rows.forEach(row => row.style.display = 'none');
                         prevEmployer2Rows.forEach(row => row.querySelectorAll('input[type="text"], input[type="number"], input[type="tel"], .currency-input').forEach(input => input.value = ''));
                    }
                } else {
                     prevEmployer1Rows.forEach(row => row.style.display = 'none');
                     prevEmployer2Rows.forEach(row => row.style.display = 'none');
                    prevEmployer1Rows.forEach(row => row.querySelectorAll('input[type="text"], input[type="number"], input[type="tel"], .currency-input').forEach(input => input.value = ''));
                    prevEmployer2Rows.forEach(row => row.querySelectorAll('input[type="text"], input[type="number"], input[type="tel"], .currency-input').forEach(input => input.value = ''));
                }
            };

            const setupBorrowerListeners = (borrowerContainerId) => {
                const container = document.getElementById(borrowerContainerId);
                if (!container) return;

                const addressYearsInput = container.querySelector('[id$="currentAddressYears"]');
                const addressMonthsInput = container.querySelector('[id$="currentAddressMonths"]');
                 const prev1AddressYearsInput = container.querySelector('[id$="prevAddress1Years"]');
                 const prev1AddressMonthsInput = container.querySelector('[id$="prevAddress1Months"]');

                if (addressYearsInput) {
                     addressYearsInput.addEventListener('input', () => updateAddressVisibility(borrowerContainerId));
                     addressYearsInput.addEventListener('change', () => updateAddressVisibility(borrowerContainerId));
                }
                 if (addressMonthsInput) {
                     addressMonthsInput.addEventListener('input', () => updateAddressVisibility(borrowerContainerId));
                     addressMonthsInput.addEventListener('change', () => updateAddressVisibility(borrowerContainerId));
                 }
                 if (prev1AddressYearsInput) {
                     prev1AddressYearsInput.addEventListener('input', () => updateAddressVisibility(borrowerContainerId));
                     prev1AddressYearsInput.addEventListener('change', () => updateAddressVisibility(borrowerContainerId));
                 }
                 if (prev1AddressMonthsInput) {
                     prev1AddressMonthsInput.addEventListener('input', () => updateAddressVisibility(borrowerContainerId));
                     prev1AddressMonthsInput.addEventListener('change', () => updateAddressVisibility(borrowerContainerId));
                 }

                const employmentYearsInput = container.querySelector('[id$="employmentYears"]');
                const employmentMonthsInput = container.querySelector('[id$="employmentMonths"]');
                 const prev1EmploymentYearsInput = container.querySelector('[id$="prevEmployment1Years"]');
                 const prev1EmploymentMonthsInput = container.querySelector('[id$="prevEmployment1Months"]');

                if (employmentYearsInput) {
                     employmentYearsInput.addEventListener('input', () => updateEmploymentVisibility(borrowerContainerId));
                     employmentYearsInput.addEventListener('change', () => updateEmploymentVisibility(borrowerContainerId));
                }
                 if (employmentMonthsInput) {
                     employmentMonthsInput.addEventListener('input', () => updateEmploymentVisibility(borrowerContainerId));
                     employmentMonthsInput.addEventListener('change', () => updateEmploymentVisibility(borrowerContainerId));
                 }
                 if (prev1EmploymentYearsInput) {
                      prev1EmploymentYearsInput.addEventListener('input', () => updateEmploymentVisibility(borrowerContainerId));
                      prev1EmploymentYearsInput.addEventListener('change', () => updateEmploymentVisibility(borrowerContainerId));
                 }
                 if (prev1EmploymentMonthsInput) {
                      prev1EmploymentMonthsInput.addEventListener('input', () => updateEmploymentVisibility(borrowerContainerId));
                      prev1EmploymentMonthsInput.addEventListener('change', () => updateEmploymentVisibility(borrowerContainerId));
                 }

                updateAddressVisibility(borrowerContainerId);
                updateEmploymentVisibility(borrowerContainerId);
            };

            setupBorrowerListeners('borrower1Container');


            // --- Add/Remove Co-Borrower Functionality (Keep and slightly adjust cloning) ---

            const toggleBorrowerBtn = document.getElementById('toggleBorrowerBtn');
            const borrower2Container = document.getElementById('borrower2Container');

            const addCoBorrower = () => {
                 if (borrower2Container.style.display !== 'none') return;

                const personalSectionTemplate = document.querySelector('.borrower-personal-section');
                const addressSectionTemplate = document.querySelector('.borrower-address-section');
                const employmentSectionTemplate = document.querySelector('.borrower-employment-section');
                const financialSectionTemplate = document.querySelector('.borrower-financial-section');

                if (!personalSectionTemplate || !addressSectionTemplate || !employmentSectionTemplate || !financialSectionTemplate) {
                     console.error("Could not find borrower section templates to clone.");
                     return;
                }

                const personalSection = personalSectionTemplate.cloneNode(true);
                const addressSection = addressSectionTemplate.cloneNode(true);
                const employmentSection = employmentSectionTemplate.cloneNode(true);
                const financialSection = financialSectionTemplate.cloneNode(true);

                const updateElementsForBorrower2 = (section) => {
                    const title = section.querySelector('h3');
                    if (title) {
                        title.textContent = 'Co-Borrower ' + title.textContent.replace('Primary Borrower ', '').replace('Personal', '').replace('Address', '').replace('Employment', '').replace('Financial', '').trim();
                    }

                    const inputs = section.querySelectorAll('input, select, textarea');
                    inputs.forEach(input => {
                         const originalId = input.id;

                         if (input.id && originalId.startsWith('borrower1_')) {
                             input.id = originalId.replace('borrower1_', 'borrower2_');
                         } else if (input.id && !originalId.startsWith('borrower2_')) {
                             input.id = 'borrower2_' + originalId;
                         }

                         const label = section.querySelector(`label[for="${originalId}"]`);
                         if (label && input.id) {
                              label.setAttribute('for', input.id);
                         } else {
                             const parentFormField = input.closest('.form-field');
                             if (parentFormField) {
                                 const potentialLabel = parentFormField.querySelector('label');
                                 if (potentialLabel && input.id) {
                                      potentialLabel.setAttribute('for', input.id);
                                 }
                             }
                         }

                        if (input.name) {
                            if (input.name.startsWith('borrower1_')) {
                                input.name = input.name.replace('borrower1_', 'borrower2_');
                            } else if (!input.name.startsWith('borrower2_')) {
                                input.name = 'borrower2_' + input.name;
                            }
                        }

                        if (input.type !== 'radio' && input.type !== 'checkbox') {
                            input.value = '';
                        } else {
                            input.checked = false;
                        }
                    });

                     section.querySelectorAll('[data-address-level], [data-employment-level]').forEach(row => {
                         row.classList.add('hidden-section');
                         row.style.display = '';
                     });
                }

                updateElementsForBorrower2(personalSection);
                updateElementsForBorrower2(addressSection);
                updateElementsForBorrower2(employmentSection);
                updateElementsForBorrower2(financialSection);

                borrower2Container.innerHTML = '';

                const header = document.createElement('div');
                header.className = 'borrower-header';
                header.textContent = 'Co-Borrower';
                borrower2Container.appendChild(header);

                borrower2Container.appendChild(personalSection);
                borrower2Container.appendChild(addressSection);
                borrower2Container.appendChild(employmentSection);
                borrower2Container.appendChild(financialSection);

                borrower2Container.style.display = 'block';

                toggleBorrowerBtn.textContent = 'Remove Co-Borrower';
                toggleBorrowerBtn.classList.remove('add-borrower-btn');
                toggleBorrowerBtn.classList.add('remove-borrower-btn');

                borrower2Container.querySelectorAll('.currency-input').forEach(input => {
                    input.addEventListener('blur', function() { formatCurrency(this); });
                    input.addEventListener('focus', function() { this.value = this.value.replace(/[$,]/g, ''); });
                });

                setupBorrowerListeners('borrower2Container');
            };

            const removeCoBorrower = () => {
                const isConfirmed = confirm('Are you sure you want to remove the co-borrower?');
                if (isConfirmed) {
                    borrower2Container.innerHTML = '';
                    borrower2Container.style.display = 'none';
                    toggleBorrowerBtn.textContent = 'Add Co-Borrower';
                    toggleBorrowerBtn.classList.remove('remove-borrower-btn');
                    toggleBorrowerBtn.classList.add('add-borrower-btn');
                }
            };

            toggleBorrowerBtn.addEventListener('click', function() {
                if (toggleBorrowerBtn.classList.contains('add-borrower-btn')) {
                    addCoBorrower();
                } else {
                    removeCoBorrower();
                }
            });


            // --- Form Validation (Keep and Refine) ---

            const validateInput = (input) => {
                input.classList.remove('invalid-input');
                const formField = input.closest('.form-field');
                if (formField) {
                    const existingError = formField.querySelector('.error-message');
                    if (existingError) {
                        existingError.remove();
                    }
                }

                let isValid = true;
                let errorMessage = '';
                const value = input.value.trim();
                const inputId = input.id;

                if (input.hasAttribute('required') && value === '') {
                     if (input.type === 'checkbox' && inputId === 'dealerAttestation' && !input.checked) {
                         isValid = false;
                         errorMessage = 'Dealer attestation is required';
                     } else if (input.type !== 'checkbox') {
                         isValid = false;
                         errorMessage = 'This field is required';
                     }
                }

                if (!isValid) {
                     applyValidationError(input, errorMessage);
                     return false;
                }

                if (value !== '') {
                    switch (input.type) {
                        case 'tel':
                            const phoneRegex = /^[\d\s\-\(\)\.]+$/;
                            if (!phoneRegex.test(value)) {
                                isValid = false;
                                errorMessage = 'Please enter a valid phone number';
                            }
                            break;

                        case 'email':
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                             if (!emailRegex.test(value)) {
                                isValid = false;
                                errorMessage = 'Please enter a valid email address';
                            }
                            break;

                        case 'date':
                            if (isNaN(Date.parse(value))) {
                                isValid = false;
                                errorMessage = 'Please enter a valid date';
                            }
                            break;

                        case 'text':
                             if (inputId.endsWith('ssn') || inputId.endsWith('_ssn')) { // Check for SSN field
                                const ssnValue = value.replace(/[\s\-]/g, '');
                                if (!/^\d{9}$/.test(ssnValue)) {
                                    isValid = false;
                                    errorMessage = 'Please enter a valid SSN (9 digits)';
                                }
                             }
                             // Add other specific text validations here if needed
                             break;

                        case 'number':
                            if (isNaN(parseFloat(value))) {
                                 isValid = false;
                                 errorMessage = 'Please enter a valid number';
                            } else {
                                 const numValue = parseFloat(value);
                                 if (input.hasAttribute('min') && numValue < parseFloat(input.getAttribute('min'))) {
                                      isValid = false;
                                      errorMessage = `Value must be at least ${input.getAttribute('min')}`;
                                 }
                                 if (input.hasAttribute('max') && numValue > parseFloat(input.getAttribute('max'))) {
                                      isValid = false;
                                      errorMessage = `Value must be at most ${input.getAttribute('max')}`;
                                 }
                            }
                            break;
                         case 'radio':
                             // Skip individual radio validation
                             needsValidation = false;
                             break;
                    }
                }

                if (!isValid) {
                    applyValidationError(input, errorMessage);
                }

                return isValid;
            };

            const applyValidationError = (input, message) => {
                input.classList.add('invalid-input');
                const formField = input.closest('.form-field');
                 if (formField && message) {
                     if (!formField.querySelector('.error-message')) {
                        const errorElement = document.createElement('div');
                        errorElement.className = 'error-message';
                        errorElement.style.color = 'red';
                        errorElement.style.fontSize = '12px';
                        errorElement.style.marginTop = '4px';
                        errorElement.textContent = message;
                        formField.appendChild(errorElement);
                     }
                }
            };

            // Validate the entire form before submission
            const validateForm = () => {
                console.log('Validating form...');
                let isFormValid = true;

                 document.querySelectorAll('.invalid-input').forEach(el => el.classList.remove('invalid-input'));
                 document.querySelectorAll('.error-message').forEach(el => el.remove());

                const formElement = document.getElementById('creditApplication');
                if (!formElement) {
                     console.error("Form element not found.");
                     return false;
                }

                const inputsToValidate = formElement.querySelectorAll('input:not([type="submit"]):not([type="button"]):not([type="reset"]):not([type="hidden"]), select, textarea');

                inputsToValidate.forEach(input => {
                    if (input.closest('.hidden-section') && input.value.trim() === '' && !input.hasAttribute('required')) {
                         return;
                    }
                    if (input.type === 'radio') {
                         return;
                    }
                     if (input.hasAttribute('readonly') && !input.hasAttribute('required')) {
                          return;
                     }


                    const fieldValid = validateInput(input);
                    if (!fieldValid) {
                        isFormValid = false;
                    }
                });

                 // --- Additional validation for radio groups if necessary ---
                 const borrowerContainers = document.querySelectorAll('.borrower-container');
                 borrowerContainers.forEach(container => {
                     if (container.style.display !== 'none') {
                          const currentAddressInput = container.querySelector('[id$="_currentAddress"]');

                           if (currentAddressInput && currentAddressInput.value.trim() !== '') {
                                const addressTypeChecked = container.querySelector('input[name="' + container.id.replace('Container', '') + '_addressType"]:checked');
                                if (!addressTypeChecked) {
                                     isFormValid = false;
                                     const radioGroupContainer = container.querySelector('[id$="addressInformation"] .radio-group');
                                      if (radioGroupContainer && !radioGroupContainer.nextElementSibling?.classList.contains('error-message')) {
                                          const errorElement = document.createElement('div');
                                          errorElement.className = 'error-message';
                                          errorElement.style.color = 'red';
                                          errorElement.style.fontSize = '12px';
                                          errorElement.style.marginTop = '4px';
                                          errorElement.textContent = 'Please select an address type for the current address.';
                                          radioGroupContainer.parentNode.insertBefore(errorElement, radioGroupContainer.nextSibling);
                                      }
                                }
                           }
                     }
                 });
                 // --- End of additional validation ---


                console.log('Form validation result:', isFormValid);
                return isFormValid;
            };


            // --- Handle Form Submission ---
            const creditAppForm = document.getElementById('creditApplication');
            const STRAPI_API_URL = 'YOUR_STRAPI_API_URL_HERE/api/credit-applications'; // <<<--- IMPORTANT: Replace with your Strapi API URL
            const STRAPI_AUTH_TOKEN = 'YOUR_STRAPI_AUTH_TOKEN_HERE'; // <<<--- IMPORTANT: Replace with your Strapi API Token or Bearer Token

             // You also need to determine the dealer ID. This might come from:
             // - A hidden input field in the form (less secure, easily manipulated)
             // - User context if the dealer is logged into your frontend application
             // - A URL parameter when the form is loaded
             // - A hardcoded value if this form is only ever used for one specific dealer (unlikely)
             // For this example, we'll use a placeholder. You'll need to replace this logic.
            const getDealerId = () => {
                 // Example: get from a hidden input field with id="dealerIdInput"
                 // const dealerInput = document.getElementById('dealerIdInput');
                 // return dealerInput ? parseInt(dealerInput.value) : null;

                 // Example: get from a global variable (set when dealer logs in)
                 // return window.currentDealerId; // Assuming window.currentDealerId is set elsewhere

                 // Example: hardcoded for testing (replace with actual logic)
                 console.warn("USING PLACEHOLDER DEALER ID. Implement actual logic to get the dealer's ID.");
                 return 1; // Replace 1 with the actual ID of the dealer

            };


            if (creditAppForm) {
                creditAppForm.addEventListener('submit', async function(event) { // Use async because fetch is asynchronous
                    event.preventDefault(); // Stop the default form submission

                    // Validate the form
                    const isFormValid = validateForm();

                    if (!isFormValid) {
                         // Validation failed, scroll to the first error and stop
                         const firstInvalidInput = document.querySelector('.invalid-input, .error-message').closest('.form-field, .radio-group'); // Find the nearest parent field/group
                         if (firstInvalidInput) {
                             firstInvalidInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                             const inputInInvalidField = firstInvalidInput.querySelector('.invalid-input');
                             if(inputInInvalidField) {
                                inputInInvalidField.focus(); // Focus the input field if found
                             }
                         }
                         alert('Please correct the errors highlighted in the form before submitting.'); // Optional alert
                        return; // Stop the submission process
                    }

                    // --- Collect Form Data into Strapi Structure ---

                    const formData = {};

                    // General Dealer Info (top level) - Mapping HTML names to Strapi names
                    formData.dealer_name = document.getElementById('dealerName').value.trim(); // Strapi: dealer_name
                    formData.dealerTelephone = document.getElementById('telephone').value.trim(); // Strapi: dealerTelephone
                    formData.dealerContact = document.getElementById('contact').value.trim(); // Strapi: dealerContact

                    // Vehicle Information (component) - Mapping HTML names to Strapi names
                    formData.vehicleInformation = {
                        year: document.getElementById('vehicleYear').value.trim(), // Strapi: year
                        makeAndModel: document.getElementById('vehicleMakeModel').value.trim(), // Strapi: makeAndModel
                        trim: document.getElementById('vehicleTrim').value.trim(), // Strapi: trim
                        mileage: parseInt(document.getElementById('vehicleMileage').value) || null, // Strapi: mileage
                        vin: document.getElementById('vehicleVIN').value.trim() // Strapi: vin
                    };

                    // Terms (component) - Mapping HTML names to Strapi names
                    formData.termsInformation = {
                        sellingPrice: parseCurrency(document.getElementById('sellingPrice').value), // Strapi: sellingPrice
                        warranty: parseCurrency(document.getElementById('warranty').value), // Strapi: warranty
                        gap: parseCurrency(document.getElementById('gap').value), // Strapi: gap
                        other: parseCurrency(document.getElementById('other').value), // Strapi: other
                        taxRate: parsePercentage(document.getElementById('taxRate').value), // Strapi: taxRate
                        taxes: parseCurrency(document.getElementById('taxes').value), // Strapi: taxes
                        docFees: parseCurrency(document.getElementById('docFees').value), // Strapi: docFees
                        titleFees: parseCurrency(document.getElementById('titleFees').value), // Strapi: titleFees
                        totalPrice: parseCurrency(document.getElementById('totalPrice').value), // Strapi: totalPrice
                        totalCashDown: parseCurrency(document.getElementById('cashDown').value), // Strapi: totalCashDown (HTML has cashDown)
                        tradeValue: parseCurrency(document.getElementById('tradeValue').value), // Strapi: tradeValue
                        tradePayoff: parseCurrency(document.getElementById('tradePayoff').value), // Strapi: tradePayoff
                        netTradeValue: parseCurrency(document.getElementById('netTradeValue').value), // Strapi: netTradeValue
                        totalDown: parseCurrency(document.getElementById('totalDown').value), // Strapi: totalDown
                        amountFinanced: parseCurrency(document.getElementById('amountFinanced').value) // Strapi: amountFinanced
                    };

                    // Borrowers (repeatable component - Array)
                    formData.borrowers = [];

                    // Helper to collect data for a single borrower (maps HTML names to Strapi component structure)
                    const collectBorrowerData = (borrowerPrefix) => {
                         const container = document.getElementById(borrowerPrefix + 'Container');
                         if (!container || container.style.display === 'none') {
                             return null;
                         }

                         const borrowerData = {};

                         // Personal Info Component - Mapping HTML names to Strapi names
                         borrowerData.personalInformation = {
                             applicantName: container.querySelector('[id$="_applicant"]').value.trim(), // Strapi: applicantName (HTML has applicant)
                             dateOfBirth: container.querySelector('[id$="_dob"]').value, // Strapi: dateOfBirth (HTML has dob)
                             ssn: container.querySelector('[id$="_ssn"]').value.trim(), // Strapi: ssn
                             driversLicense: container.querySelector('[id$="_driversLicense"]').value.trim(), // Strapi: driversLicense
                             homePhone: container.querySelector('[id$="_homePhone"]').value.trim(), // Strapi: homePhone
                             workPhone: container.querySelector('[id$="_workPhone"]').value.trim(), // Strapi: workPhone
                             cellPhone: container.querySelector('[id$="_cellPhone"]').value.trim(), // Strapi: cellPhone
                             email: container.querySelector('[id$="_email"]').value.trim() // Strapi: email
                         };

                         // Address Info Component - Contains nested AddressEntry components
                         const currentAddressYearsInput = container.querySelector('[id$="_currentAddressYears"]');
                         const currentAddressMonthsInput = container.querySelector('[id$="_currentAddressMonths"]');
                         const prevAddress1YearsInput = container.querySelector('[id$="_prevAddress1Years"]');
                         const prevAddress1MonthsInput = container.querySelector('[id$="_prevAddress1Months"]');


                         borrowerData.addressInformation = {
                              // Current AddressEntry Component - Mapping HTML names to Strapi names
                             current: {
                                 address: container.querySelector('[id$="_currentAddress"]').value.trim(), // Strapi: address
                                 addressType: container.querySelector('input[name="' + borrowerPrefix + '_addressType"]:checked')?.value || null, // Strapi: addressType
                                 landlordInfo: container.querySelector('[id$="_landlordInfo"]').value.trim(), // Strapi: landlordInfo
                                 years: parseInt(currentAddressYearsInput.value) || 0, // Strapi: years
                                 months: parseInt(currentAddressMonthsInput.value) || 0 // Strapi: months
                             },
                              // Previous1 AddressEntry Component - Mapping HTML names to Strapi names
                             previous1: null,
                              // Previous2 AddressEntry Component - Mapping HTML names to Strapi names
                             previous2: null
                         };

                         const prevAddress1Row = container.querySelector('[data-address-level="1"]');
                         if (prevAddress1Row && prevAddress1Row.style.display !== 'none') {
                              const address1Value = container.querySelector('[id$="_previousAddress1"]').value.trim();
                              const landlord1Value = container.querySelector('[id$="_prevAddress1LandlordInfo"]').value.trim();
                              const years1Value = parseInt(prevAddress1YearsInput.value) || 0;
                              const months1Value = parseInt(prevAddress1MonthsInput.value) || 0;
                              if (address1Value || landlord1Value || years1Value > 0 || months1Value > 0) {
                                  borrowerData.addressInformation.previous1 = {
                                      address: address1Value, // Strapi: address
                                      landlordInfo: landlord1Value, // Strapi: landlordInfo (HTML has prevAddress1LandlordInfo)
                                      years: years1Value, // Strapi: years
                                      months: months1Value // Strapi: months
                                  };
                              }
                         }

                         const prevAddress2Row = container.querySelector('[data-address-level="2"]');
                         if (prevAddress2Row && prevAddress2Row.style.display !== 'none') {
                             const address2Value = container.querySelector('[id$="_previousAddress2"]').value.trim();
                              const landlord2Value = container.querySelector('[id$="_prevAddress2LandlordInfo"]').value.trim();
                             const years2Value = parseInt(container.querySelector('[id$="_prevAddress2Years"]').value) || 0;
                             const months2Value = parseInt(container.querySelector('[id$="_prevAddress2Months"]').value) || 0;
                             if (address2Value || landlord2Value || years2Value > 0 || months2Value > 0) {
                                  borrowerData.addressInformation.previous2 = {
                                      address: address2Value, // Strapi: address
                                      landlordInfo: landlord2Value, // Strapi: landlordInfo (HTML has prevAddress2LandlordInfo)
                                      years: years2Value, // Strapi: years
                                      months: months2Value // Strapi: months
                                  };
                              }
                         }


                         // Employment Information Component - Contains nested EmploymentEntry components
                         const currentEmploymentYearsInput = container.querySelector('[id$="_employmentYears"]');
                         const currentEmploymentMonthsInput = container.querySelector('[id$="_employmentMonths"]');
                         const prev1EmploymentYearsInput = container.querySelector('[id$="_prevEmployment1Years"]');
                         const prev1EmploymentMonthsInput = container.querySelector('[id$="_prevEmployment1Months"]');


                         borrowerData.employmentInformation = {
                             // Current EmploymentEntry Component - Mapping HTML names to Strapi names
                             current: {
                                 employerName: container.querySelector('[id$="_currentEmployer"]').value.trim(), // Strapi: employerName (HTML has currentEmployer)
                                 phone: container.querySelector('[id$="_employerPhone"]').value.trim(), // Strapi: phone (HTML has employerPhone)
                                 title: container.querySelector('[id$="_title"]').value.trim(), // Strapi: title
                                 employerAddress: container.querySelector('[id$="_employerAddress"]').value.trim(), // Strapi: employerAddress
                                 income: parseCurrency(container.querySelector('[id$="_income"]').value), // Strapi: income
                                 years: parseInt(currentEmploymentYearsInput.value) || 0, // Strapi: years
                                 months: parseInt(currentEmploymentMonthsInput.value) || 0 // Strapi: months
                             },
                             previous1: null,
                             previous2: null
                         };

                         const prevEmployer1Rows = container.querySelectorAll('[data-employment-level="1"]');
                         if (prevEmployer1Rows.length > 0 && prevEmployer1Rows[0].style.display !== 'none') {
                              const employer1Name = container.querySelector('[id$="_previousEmployer1"]').value.trim();
                              const employer1Phone = container.querySelector('[id$="_prevEmployer1Phone"]').value.trim();
                              const employer1Title = container.querySelector('[id$="_prevEmployer1Title"]').value.trim();
                              const employer1Address = container.querySelector('[id$="_prevEmployer1Address"]').value.trim();
                              const employer1Income = parseCurrency(container.querySelector('[id$="_prevEmployer1Income"]').value);
                              const employment1Years = parseInt(prev1EmploymentYearsInput.value) || 0;
                              const employment1Months = parseInt(prev1EmploymentMonthsInput.value) || 0;

                             if (employer1Name || employment1Years > 0 || employment1Months > 0) {
                                  borrowerData.employmentInformation.previous1 = {
                                     employerName: employer1Name, // Strapi: employerName (HTML has previousEmployer1)
                                     phone: employer1Phone, // Strapi: phone (HTML has prevEmployer1Phone)
                                     title: employer1Title, // Strapi: title
                                     employerAddress: employer1Address, // Strapi: employerAddress
                                     income: employer1Income, // Strapi: income
                                     years: employment1Years, // Strapi: years
                                     months: employment1Months // Strapi: months
                                  };
                              }
                         }

                         const prevEmployer2Rows = container.querySelectorAll('[data-employment-level="2"]');
                         if (prevEmployer2Rows.length > 0 && prevEmployer2Rows[0].style.display !== 'none') {
                              const employer2Name = container.querySelector('[id$="_previousEmployer2"]').value.trim();
                              const employer2Phone = container.querySelector('[id$="_prevEmployer2Phone"]').value.trim();
                              const employer2Title = container.querySelector('[id$="_prevEmployer2Title"]').value.trim();
                              const employer2Address = container.querySelector('[id$="_prevEmployer2Address"]').value.trim();
                              const employer2Income = parseCurrency(container.querySelector('[id$="_prevEmployer2Income"]').value);
                              const employment2Years = parseInt(container.querySelector('[id$="_prevEmployment2Years"]').value) || 0;
                              const employment2Months = parseInt(container.querySelector('[id$="_prevEmployment2Months"]').value) || 0;

                              if (employer2Name || employment2Years > 0 || employment2Months > 0) {
                                   borrowerData.employmentInformation.previous2 = {
                                      employerName: employer2Name, // Strapi: employerName (HTML has previousEmployer2)
                                      phone: employer2Phone, // Strapi: phone (HTML has prevEmployer2Phone)
                                      title: employer2Title, // Strapi: title
                                      employerAddress: employer2Address, // Strapi: employerAddress
                                      income: employer2Income, // Strapi: income
                                      years: employment2Years, // Strapi: years
                                      months: employment2Months // Strapi: months
                                   };
                              }
                         }


                         // Financial Information Component - Mapping HTML names to Strapi names
                         borrowerData.financialInformation = {
                              // Convert radio button values ('yes'/'no') to booleans
                             alimonyPaymentsObliged: container.querySelector('input[name="' + borrowerPrefix + '_alimonyPayments"]:checked')?.value === 'yes', // Strapi: alimonyPaymentsObliged (HTML name has alimonyPayments)
                             alimonyRecipient: container.querySelector('[id$="_alimonyRecipient"]').value.trim(), // Strapi: alimonyRecipient
                             alimonyAmount: parseCurrency(container.querySelector('[id$="_alimonyAmount"]').value), // Strapi: alimonyAmount
                             isCoMaker: container.querySelector('input[name="' + borrowerPrefix + '_coMaker"]:checked')?.value === 'yes', // Strapi: isCoMaker (HTML name has coMaker)
                             coMakerFor: container.querySelector('[id$="_coMakerFor"]').value.trim(), // Strapi: coMakerFor
                             coMakerToWhom: container.querySelector('[id$="_coMakerToWhom"]').value.trim(), // Strapi: coMakerToWhom
                             hasJudgments: container.querySelector('input[name="' + borrowerPrefix + '_judgments"]:checked')?.value === 'yes', // Strapi: hasJudgments (HTML name has judgments)
                             judgmentToWhom: container.querySelector('[id$="_judgmentToWhom"]').value.trim(), // Strapi: judgmentToWhom
                             judgmentAmount: parseCurrency(container.querySelector('[id$="_judgmentAmount"]').value), // Strapi: judgmentAmount
                             hasBankruptcy: container.querySelector('input[name="' + borrowerPrefix + '_bankruptcy"]:checked')?.value === 'yes', // Strapi: hasBankruptcy (HTML name has bankruptcy)
                             bankruptcyWhere: container.querySelector('[id$="_bankruptcyWhere"]').value.trim(), // Strapi: bankruptcyWhere
                             bankruptcyYear: container.querySelector('[id$="_bankruptcyYear"]').value.trim() // Strapi: bankruptcyYear
                         };


                         return borrowerData;
                    };

                    // Add Primary Borrower data
                    const borrower1Data = collectBorrowerData('borrower1');
                    if (borrower1Data) {
                        formData.borrowers.push(borrower1Data);
                    }

                    // Add Co-Borrower data if visible
                    const borrower2Data = collectBorrowerData('borrower2');
                    if (borrower2Data) {
                         if (document.getElementById('borrower2Container').style.display !== 'none') {
                              formData.borrowers.push(borrower2Data);
                         }
                    }

                    // Dealer Attestation (top level) - Mapping HTML names to Strapi names
                    formData.dealerAttestation = document.getElementById('dealerAttestation').checked; // Strapi: dealerAttestation
                    formData.signatureDate = document.getElementById('signatureDate').value; // Strapi: signatureDate

                    // Add the Dealer relationship ID (top level)
                    const dealerId = getDealerId(); // Get the ID from your implemented logic
                     if (dealerId !== null && dealerId !== undefined) { // Ensure dealerId is valid
                         // Strapi expects the ID directly for a relation field
                         formData.dealer = dealerId; // Strapi: dealer
                     } else {
                         console.error("Dealer ID is missing or invalid! Cannot submit application.");
                         alert("Error: Dealer information missing. Cannot submit.");
                         return;
                     }

                    console.log('Collected Data (Strapi Format):', formData); // Log the collected data structure


                    // --- Send Data to Strapi API ---

                    try {
                        // Add UI feedback for submission (e.g., disable button, show loading spinner)
                        const submitButton = creditAppForm.querySelector('.submit-btn');
                        submitButton.disabled = true;
                        submitButton.textContent = 'Submitting...';


                        const response = await fetch(STRAPI_API_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                // Include Authorization header if not using the Public role for creation
                                'Authorization': `Bearer ${STRAPI_AUTH_TOKEN}`
                            },
                            body: JSON.stringify({ data: formData }) // Wrap your data in a 'data' key for Strapi V4
                        });

                        // Re-enable button regardless of success/failure
                        submitButton.disabled = false;
                        submitButton.textContent = 'Submit Application';

                        if (!response.ok) {
                            const error = await response.json();
                            console.error('Submission failed:', response.status, response.statusText, error);
                            alert('Submission failed: ' + (error.error?.message || response.statusText));
                            // Optionally scroll to errors if Strapi returns validation errors
                            return;
                        }

                        const result = await response.json();
                        console.log('Submission successful:', result);

                        alert('Application submitted successfully!');
                        // Optional: Redirect user or clear the form
                        // window.location.href = '/success-page'; // Redirect
                        creditAppForm.reset(); // Clear the form
                         // Reset visibility of previous address/employment fields after reset
                         document.querySelectorAll('.borrower-container').forEach(container => {
                              setupBorrowerListeners(container.id); // Re-run visibility setup
                         });
                         removeCoBorrower(); // Ensure co-borrower is removed visually after reset (resets button text too)


                    } catch (error) {
                        console.error('Network or unexpected error:', error);
                        alert('An error occurred during submission. Please try again.');

                        // Ensure button is re-enabled on network error too
                         const submitButton = creditAppForm.querySelector('.submit-btn');
                         submitButton.disabled = false;
                         submitButton.textContent = 'Submit Application';
                    }

                });
            }


        }); // End of DOMContentLoaded
    </script>
</body>
</html>